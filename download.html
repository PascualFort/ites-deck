<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Descargar Documentos - ITES Hub Audiovisual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0a0a2a;
        color: #e0e0e0;
      }

      .glass-effect {
        background: rgba(10, 10, 42, 0.85);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .btn-primary {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        transition: all 0.3s ease;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(79, 70, 229, 0.2);
      }

      .card {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(79, 70, 229, 0.2);
      }

      .document-viewer {
        background: #1a1a1a;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .viewer-container {
        height: 600px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header
      class="glass-effect sticky top-0 z-50 shadow-lg shadow-indigo-500/10"
    >
      <div class="container mx-auto px-4">
        <div class="flex items-center justify-between py-4">
          <div class="flex items-center">
            <a href="index.html" class="flex items-center">
              <img
                src="assets/white-logo.png"
                alt="ITES Hub Audiovisual"
                class="h-8 w-auto mr-3"
              />
              <span class="text-white font-semibold">ITES Hub Audiovisual</span>
            </a>
          </div>
          <a
            href="index.html"
            class="text-gray-300 hover:text-white transition-colors"
          >
            <i class="fas fa-arrow-left mr-2"></i>Volver al inicio
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
      <div class="max-w-6xl mx-auto">
        <!-- Hero Section -->
        <div class="text-center mb-12">
          <h1 class="text-4xl md:text-5xl font-black mb-4">
            <span class="text-indigo-400">Documentos</span> de Inversión
          </h1>
          <p class="text-xl text-gray-400 max-w-3xl mx-auto">
            Visualiza y descarga la presentación completa de la oportunidad de
            inversión en el sector audiovisual.
          </p>
        </div>

        <!-- Document Viewer -->
        <div class="card rounded-2xl p-8 mb-12">
          <div class="text-center mb-8">
            <h3 class="text-3xl font-bold text-white mb-4">
              Documento de Inversión
            </h3>
            <p class="text-gray-400">
              Presentación completa de la oportunidad de inversión en el sector
              audiovisual
            </p>
          </div>

          <!-- Document Viewer Container -->
          <div class="document-viewer">
            <div id="viewerContainer" class="viewer-container">
              <!-- ViewerJS will be loaded here -->
            </div>
          </div>
        </div>

        <!-- Email Form Section -->
        <div class="card rounded-2xl p-8 md:p-12">
          <div class="text-center mb-8">
            <div
              class="w-16 h-16 bg-indigo-500/20 rounded-full flex items-center justify-center mx-auto mb-4"
            >
              <i class="fas fa-envelope text-2xl text-indigo-400"></i>
            </div>
            <h2 class="text-3xl font-bold text-white mb-4">
              Recibe los documentos por email
            </h2>
            <p class="text-gray-400 max-w-2xl mx-auto">
              Introduce tu email y recibirás ambos documentos en tu bandeja de
              entrada. También te enviaremos información adicional sobre la
              oportunidad de inversión.
            </p>
          </div>

          <form id="downloadForm" class="max-w-md mx-auto">
            <div class="mb-6">
              <label
                for="user_name"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Nombre completo *
              </label>
              <input
                type="text"
                id="user_name"
                name="user_name"
                required
                class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="Tu nombre completo"
              />
            </div>

            <div class="mb-6">
              <label
                for="user_email"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Email *
              </label>
              <input
                type="email"
                id="user_email"
                name="user_email"
                required
                class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="tu@email.com"
              />
            </div>

            <div class="mb-6">
              <label
                for="user_company"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Empresa (opcional)
              </label>
              <input
                type="text"
                id="user_company"
                name="user_company"
                class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="Nombre de tu empresa"
              />
            </div>

            <button
              type="submit"
              id="submitBtn"
              class="w-full btn-primary text-white font-semibold py-4 px-6 rounded-lg text-lg"
            >
              <i class="fas fa-download mr-2"></i>
              Enviar Documentos
            </button>
          </form>
        </div>

        <!-- Contact Section -->
        <div class="text-center mt-12">
          <div class="card rounded-2xl p-8">
            <h3 class="text-2xl font-bold text-white mb-4">
              ¿Tienes preguntas?
            </h3>
            <p class="text-gray-400 mb-6">
              Nuestro equipo está disponible para resolver cualquier duda sobre
              la oportunidad de inversión
            </p>
            <button
              onclick="openContactModal('dcodina@ites.es')"
              class="btn-primary text-white font-semibold py-3 px-8 rounded-lg inline-flex items-center"
            >
              <i class="fas fa-envelope mr-2"></i>
              Contactar con el equipo
            </button>
          </div>
        </div>
      </div>
    </main>

    <!-- Success Modal -->
    <div
      id="successModal"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] hidden items-center justify-center p-4"
    >
      <div
        class="bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-gray-700"
      >
        <div class="p-8 text-center">
          <div
            class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4"
          >
            <i class="fas fa-check text-2xl text-green-400"></i>
          </div>
          <h3 class="text-xl font-bold text-white mb-2">¡Solicitud enviada!</h3>
          <p class="text-gray-300 mb-6">
            Hemos notificado a nuestro equipo y la presentación PowerPoint se
            está descargando automáticamente.
          </p>
          <button
            onclick="closeSuccessModal()"
            class="btn-primary text-white font-semibold py-3 px-6 rounded-lg"
          >
            Entendido
          </button>
        </div>
      </div>
    </div>

    <!-- Contact Modal -->
    <div
      id="contactModal"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[10000] hidden items-center justify-center p-4"
    >
      <div
        class="bg-gray-900 rounded-2xl shadow-2xl max-w-md w-full mx-4 border border-gray-700"
      >
        <!-- Modal Header -->
        <div
          class="flex items-center justify-between p-6 border-b border-gray-700"
        >
          <h3 class="text-xl font-bold text-white">Solicitar información</h3>
          <button
            id="closeModal"
            class="text-gray-400 hover:text-white transition-colors"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <!-- Modal Body -->
        <div class="p-6">
          <p class="text-gray-300 mb-4">
            Enviar mensaje a:
            <span
              id="recipientInfo"
              class="text-indigo-400 font-semibold"
            ></span>
          </p>

          <form id="contactForm" class="space-y-4">
            <div>
              <label
                for="contact_user_name"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Nombre *
              </label>
              <input
                type="text"
                id="contact_user_name"
                name="user_name"
                required
                class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="Tu nombre"
              />
            </div>

            <div>
              <label
                for="contact_user_email"
                class="block text-sm font-medium text-gray-300 mb-2"
              >
                Email *
              </label>
              <input
                type="email"
                id="contact_user_email"
                name="user_email"
                required
                class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                placeholder="tu@email.com"
              />
            </div>

            <button
              type="submit"
              id="contactSubmitBtn"
              class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"
            >
              Enviar Solicitud
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Initialize EmailJS
      (function () {
        emailjs.init("gy7MkR7OLXUPSlOfv");
      })();

      const googleSlidesUrl =
        "https://docs.google.com/presentation/d/1PAX6bqOy8mvaKciScck3BtZ4szYAlLx-weTw-ieGxNk/embed?start=false&loop=false&delayms=3000";
      const documentUrl =
        "docs/Oportunidad de Inversión en ITES Hub Audiovisual (1).pptx";

      // Load presentation using Google Slides
      async function loadDocument() {
        const container = document.getElementById("viewerContainer");
        container.innerHTML =
          '<div class="flex items-center justify-center h-full"><i class="fas fa-spinner fa-spin text-2xl text-indigo-400"></i></div>';

        try {
          // Try Google Slides first
          await tryGoogleSlidesViewer(container);
        } catch (error) {
          console.error("Google Slides failed, trying fallback:", error);
          try {
            await tryFallbackViewer(container);
          } catch (error2) {
            console.error("All viewers failed:", error2);
            showErrorFallback();
          }
        }
      }

      async function tryGoogleSlidesViewer(container) {
        return new Promise((resolve, reject) => {
          console.log("Trying Google Slides viewer:", googleSlidesUrl);

          const iframe = document.createElement("iframe");
          iframe.src = googleSlidesUrl;
          iframe.style.width = "100%";
          iframe.style.height = "100%";
          iframe.style.border = "none";
          iframe.allowFullscreen = true;
          iframe.setAttribute("frameborder", "0");
          iframe.setAttribute("allow", "fullscreen");

          iframe.onload = function () {
            console.log("Google Slides viewer loaded successfully");
            resolve();
          };

          iframe.onerror = function () {
            console.log("Google Slides viewer failed");
            reject(new Error("Google Slides viewer failed"));
          };

          container.innerHTML = "";
          container.appendChild(iframe);

          // Timeout after 10 seconds
          setTimeout(() => {
            if (container.querySelector("iframe")) {
              console.log("Google Slides viewer timeout");
              reject(new Error("Google Slides viewer timeout"));
            }
          }, 10000);
        });
      }

      async function tryFallbackViewer(container) {
        return new Promise((resolve, reject) => {
          const encodedUrl = encodeURIComponent(
            window.location.origin + "/" + documentUrl
          );

          // Try multiple viewer options
          const viewerOptions = [
            {
              name: "Microsoft Office Online",
              url: `https://view.officeapps.live.com/op/embed.aspx?src=${encodedUrl}`,
            },
            {
              name: "Google Docs Viewer",
              url: `https://docs.google.com/viewer?url=${encodedUrl}&embedded=true`,
            },
          ];

          let currentOption = 0;

          function tryNextViewer() {
            if (currentOption >= viewerOptions.length) {
              reject(new Error("All viewers failed"));
              return;
            }

            const option = viewerOptions[currentOption];
            console.log(`Trying ${option.name} viewer:`, option.url);

            const iframe = document.createElement("iframe");
            iframe.src = option.url;
            iframe.style.width = "100%";
            iframe.style.height = "100%";
            iframe.style.border = "none";
            iframe.allowFullscreen = true;
            iframe.setAttribute("frameborder", "0");

            iframe.onload = function () {
              console.log(`${option.name} viewer loaded successfully`);
              resolve();
            };

            iframe.onerror = function () {
              console.log(`${option.name} viewer failed, trying next option`);
              currentOption++;
              setTimeout(tryNextViewer, 1000);
            };

            container.innerHTML = "";
            container.appendChild(iframe);

            // Timeout after 8 seconds for each viewer
            setTimeout(() => {
              if (container.querySelector("iframe")) {
                console.log(
                  `${option.name} viewer timeout, trying next option`
                );
                currentOption++;
                setTimeout(tryNextViewer, 1000);
              }
            }, 8000);
          }

          tryNextViewer();
        });
      }

      function showErrorFallback() {
        const container = document.getElementById("viewerContainer");
        container.innerHTML = `
          <div class="flex items-center justify-center h-full text-center">
            <div>
              <i class="fas fa-exclamation-triangle text-4xl text-red-400 mb-4"></i>
              <h3 class="text-xl font-bold text-white mb-2">Error al cargar la presentación</h3>
              <p class="text-gray-400 mb-4">No se pudo cargar la presentación en el navegador. Esto puede deberse a:</p>
              <ul class="text-gray-400 text-sm mb-6 text-left max-w-md mx-auto">
                <li>• El archivo no está accesible públicamente</li>
                <li>• Problemas de conectividad con los servicios de visualización</li>
                <li>• Restricciones de CORS</li>
              </ul>
              <div class="space-y-3">
                <a href="${documentUrl}" target="_blank" class="btn-primary text-white font-semibold py-3 px-6 rounded-lg inline-flex items-center">
                  <i class="fas fa-download mr-2"></i>
                  Descargar presentación
                </a>
                <br>
                <button onclick="showSimplePreview()" class="glass-effect text-white font-semibold py-3 px-6 rounded-lg inline-flex items-center">
                  <i class="fas fa-eye mr-2"></i>
                  Ver vista previa simple
                </button>
              </div>
            </div>
          </div>
        `;
      }

      function showSimplePreview() {
        const container = document.getElementById("viewerContainer");
        container.innerHTML = `
          <div class="flex items-center justify-center h-full text-center">
            <div>
              <div class="w-32 h-32 bg-blue-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fab fa-google-drive text-5xl text-blue-400"></i>
              </div>
              <h3 class="text-2xl font-bold text-white mb-4">Presentación Google Slides</h3>
              <p class="text-gray-400 mb-6">Documento de inversión ITES Hub Audiovisual</p>
              <div class="space-y-3">
                <a href="https://docs.google.com/presentation/d/1PAX6bqOy8mvaKciScck3BtZ4szYAlLx-weTw-ieGxNk/edit?usp=sharing" target="_blank" class="btn-primary text-white font-semibold py-3 px-6 rounded-lg inline-flex items-center">
                  <i class="fas fa-external-link-alt mr-2"></i>
                  Abrir en Google Slides
                </a>
                <br>
                <a href="${documentUrl}" download class="glass-effect text-white font-semibold py-3 px-6 rounded-lg inline-flex items-center">
                  <i class="fas fa-download mr-2"></i>
                  Descargar PowerPoint
                </a>
              </div>
            </div>
          </div>
        `;
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        // Wait a bit for all libraries to load
        setTimeout(() => {
          loadDocument();
        }, 1000);
      });

      // Contact Modal Variables
      let currentRecipient = "dcodina@ites.es";
      const modal = document.getElementById("contactModal");
      const recipientInfo = document.getElementById("recipientInfo");
      const contactForm = document.getElementById("contactForm");
      const contactSubmitBtn = document.getElementById("contactSubmitBtn");
      const closeModal = document.getElementById("closeModal");

      // Open modal function
      function openContactModal(recipient = "dcodina@ites.es") {
        console.log("Opening modal for:", recipient);
        currentRecipient = recipient;
        recipientInfo.textContent = recipient;
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        document.body.style.overflow = "hidden";
      }

      // Close modal function
      function closeContactModal() {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        document.body.style.overflow = "auto";
        contactForm.reset();

        // Reset button to initial state
        contactSubmitBtn.innerHTML = "Enviar Solicitud";
        contactSubmitBtn.disabled = false;
        contactSubmitBtn.classList.remove(
          "from-green-600",
          "to-green-700",
          "from-red-600",
          "to-red-700"
        );
        contactSubmitBtn.classList.add("from-indigo-600", "to-purple-600");
      }

      // Close modal events
      closeModal.addEventListener("click", closeContactModal);
      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeContactModal();
        }
      });

      // Escape key to close modal
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && !modal.classList.contains("hidden")) {
          closeContactModal();
        }
      });

      // Contact form submission
      contactForm.addEventListener("submit", function (e) {
        e.preventDefault();

        // Show loading state
        contactSubmitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
        contactSubmitBtn.disabled = true;

        const formData = new FormData(contactForm);
        const userEmail = formData.get("user_email");
        const userName = formData.get("user_name");

        // Auto-generate message in Spanish
        const autoMessage = `Solicitud de información de ${userEmail}. Nombre: ${userName}`;

        const templateParams = {
          user_name: userName,
          user_email: userEmail,
          message: autoMessage,
          to_email: currentRecipient,
        };

        // Send email using EmailJS
        emailjs
          .send("parallax-website", "template_3y9jjid", templateParams)
          .then(function (response) {
            // Show success state
            contactSubmitBtn.innerHTML =
              '<i class="fas fa-check mr-2"></i>¡Enviado!';
            contactSubmitBtn.classList.remove(
              "from-indigo-600",
              "to-purple-600"
            );
            contactSubmitBtn.classList.add("from-green-600", "to-green-700");

            // Close modal after 1.5 seconds
            setTimeout(() => {
              closeContactModal();
            }, 1500);
          })
          .catch(function (error) {
            // Show error state
            contactSubmitBtn.innerHTML =
              '<i class="fas fa-exclamation-triangle mr-2"></i>Error - Reintentar';
            contactSubmitBtn.classList.remove(
              "from-indigo-600",
              "to-purple-600"
            );
            contactSubmitBtn.classList.add("from-red-600", "to-red-700");
            contactSubmitBtn.disabled = false;

            // Reset button after 3 seconds
            setTimeout(() => {
              contactSubmitBtn.innerHTML = "Enviar Solicitud";
              contactSubmitBtn.classList.remove("from-red-600", "to-red-700");
              contactSubmitBtn.classList.add(
                "from-indigo-600",
                "to-purple-600"
              );
            }, 3000);
          });
      });

      // Email form handling
      const downloadForm = document.getElementById("downloadForm");
      const submitBtn = document.getElementById("submitBtn");
      const successModal = document.getElementById("successModal");

      downloadForm.addEventListener("submit", function (e) {
        e.preventDefault();

        submitBtn.innerHTML =
          '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
        submitBtn.disabled = true;

        const formData = new FormData(downloadForm);
        const userEmail = formData.get("user_email");
        const userName = formData.get("user_name");
        const userCompany = formData.get("user_company");

        const autoMessage = `Solicitud de documentos de inversión de ${userEmail}. Nombre: ${userName}${
          userCompany ? ", Empresa: " + userCompany : ""
        }`;

        // Email 1: Notification to dcodina@ites.es
        const notificationParams = {
          user_name: userName,
          user_email: userEmail,
          user_company: userCompany || "No especificada",
          message: autoMessage,
          to_email: "dcodina@ites.es",
          subject: "Solicitud de documentos de inversión ITES",
        };

        // Send notification email to dcodina@ites.es
        emailjs
          .send("parallax-website", "template_3y9jjid", notificationParams)
          .then(function (response) {
            console.log("Email sent successfully:", response);

            // Trigger PowerPoint download
            const downloadLink = document.createElement("a");
            downloadLink.href =
              "docs/Oportunidad de Inversión en ITES Hub Audiovisual (1).pptx";
            downloadLink.download =
              "Oportunidad de Inversión en ITES Hub Audiovisual.pptx";
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);

            successModal.classList.remove("hidden");
            successModal.classList.add("flex");
            downloadForm.reset();
            submitBtn.innerHTML =
              '<i class="fas fa-download mr-2"></i>Enviar Documentos';
            submitBtn.disabled = false;
          })
          .catch(function (error) {
            console.error("EmailJS error:", error);
            submitBtn.innerHTML =
              '<i class="fas fa-exclamation-triangle mr-2"></i>Error - Reintentar';
            submitBtn.disabled = false;
            setTimeout(() => {
              submitBtn.innerHTML =
                '<i class="fas fa-download mr-2"></i>Enviar Documentos';
            }, 3000);
          });
      });

      function closeSuccessModal() {
        successModal.classList.add("hidden");
        successModal.classList.remove("flex");
      }

      successModal.addEventListener("click", function (e) {
        if (e.target === successModal) {
          closeSuccessModal();
        }
      });

      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape" && !successModal.classList.contains("hidden")) {
          closeSuccessModal();
        }
      });
    </script>
  </body>
</html>
